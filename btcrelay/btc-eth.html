<!DOCTYPE html>
<html lang="en">
<head>
  <title>JavaScript API</title>
  <link rel="stylesheet" href="./css/bootstrap.min.css">
  <script src="./js/jquery-2.1.3.min.js"></script>
  <script src="./js/bootstrap.min.js"></script>



<script src="bignumber.js"></script>
<script src="ethereum.min.js"></script>

<script type="text/javascript">
var web3 = require('web3');
    web3.setProvider(new web3.providers.HttpSyncProvider());
    // web3.setProvider(new web3.providers.HttpSyncProvider("http://localhost:8545"))

// web3.setProvider(new web3.providers.AutoProvider());
// web3.setProvider(new web3.providers.WebSocketProvider('ws://localhost:40404/eth'));

///First web3.eth.watch code to monitor coinbase
web3.eth.watch('pending').changed(function(){
    var coinbase = web3.eth.coinbase;
  	document.getElementById('coinbase').innerText = coinbase;

    var balance = web3.eth.balanceAt(coinbase);
  	document.getElementById('balance').innerText = balance;
});

///Insert your contract address var here:


///Second web3.eth.watch code to monitor block number
// web3.eth.watch().changed(function(){
// 	web3.eth.block(web3.eth.number).then(function(result){
//     	document.getElementById('latestBlock').innerText = web3.eth.number._result;
//     	document.getElementById('latestBlockHash').innerText = result.hash;
//     	document.getElementById('latestBlockTimestamp').innerText = Date(result.timestamp);
//   	})
// });


// curl -X POST --data '{"jsonrpc":"2.0","method":"eth_balanceAt","params":["0x205215f022af4950618730bcfae161b28397bc41"],"id":1}' http://localhost:8080


var bethAddress = '0x02f653a05dc68a7df9a74c8eb9a50a15e98bed6e';
var bethAbi = [
  {
    'name': 'processTransfer(int256)',
    'type': 'function',
    'inputs': [{
      'name': 'n',
      'type': 'int256'
    }],
    'outputs': [
        {
            "name": "d",
            "type": "int256"
        }
    ]
  }
];


// var bethAddress = '0x82a05f47635daab083ee267b4a1f20f949d9392f';
// var bethAbi = [
//   {
//     'name': 'callsA',
//     'constant': false,
//     'inputs': [{
//       'name': 'n',
//       'type': 'int256'
//     }],
//     'outputs': [
//         {
//             "name": "d",
//             "type": "int256"
//         }
//     ]
//   }
// ];


// var bethAddress = '0xd91d87f8b485a028bc17c1d47c3703ff01483e14';
// var bethAbi = [
//   {
//     'name': 'test',
//     'constant': false,
//     'inputs': [{
//       'name': 'arr',
//       'type': 'int[]'
//     },
//     {
//       'name': 'm',
//       'type': 'int'
//     }
//     ],
//     'outputs': [
//         {
//             "name": "d",
//             "type": "int256"
//         }
//     ]
//   }
// ];



// var bethAddress = '0x47fab65f1fb1e41d07d4566dba342c04d5b57192';
// var bethAbi = [
//   {
//     'name': 'test',
//     'constant': false,
//     'inputs': [{
//       'name': 'arr',
//       'type': 'int[]'
//     }],
//     'outputs': [
//         {
//             "name": "d",
//             "type": "int256"
//         }
//     ]
//   }
// ];




// var bethAddress = '0x01c64ba40b13ed3e43d7efebb748d5da7548ea7e';
// var bethAbi = [
//   {
//     'name': 'btest',
//     'constant': false,
//     'inputs': [{
//       'name': 'str',
//       'type': 'string'
//     }],
//     'outputs': [
//         {
//             "name": "d",
//             "type": "int256"
//         }
//     ]
//   }
// ];


// var bethAddress = '0xb2790180f2bf3fdc2b496b576814de183661a51f';
// var bethAbi = [
//   {
//     'name': 'callsA',
//     'constant': false,
//     'inputs': [{
//       'name': 'n',
//       'type': 'int[]'
//     },
//     {
//       'name': 'x',
//       'type': 'int256'
//     }],
//     'outputs': [
//         {
//             "name": "d",
//             "type": "int256"
//         }
//     ]
//   }
// ];




var contract = web3.eth.contract(bethAddress, bethAbi);

var padLeft = function (string, chars) {
    return new Array(chars - string.length + 1).join("0") + string;
};

function callExampleContract() {
  // param = 9;
  var param = parseInt(document.getElementById('value').value);

  var res = contract.call().processTransfer(param);
  // var res = contract.transact().processTransfer('1300');
  document.getElementById('result').innerText = res.toString(10);


  // 34 chars
  // contract.btest('1234567890123456789012345678901234').transact().then(function(res) {
  //         document.getElementById('result').innerText = res[0];
  //     });

  // contract.callsA(['0x77'], '0x205215f022af4950618730bcfae161b28397bc41').transact().then(function(res) {
  //           document.getElementById('result').innerText = res[0];
  //       });

        // this should be generated by ethereum
        //var param = parseInt(document.getElementById('value').value);
        // call the contract
        // var extra = {};
        // extra.to =
        // // extra.data = ''
        // //extra.data = param;
        // extra.data = "0x" + padLeft((11).toString(16), 64);
        // web3.eth.transact(extra).then(function(res) {
        //     document.getElementById('result').innerText = res[0];
        // });
        //
        //
  // var extra = {};
  // extra.to = bethAddress;
  // extra.data = '0x000000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000b000000000000000000000000205215f022af4950618730bcfae161b28397bc41'
  // web3.eth.transact(extra).then(function(res) {
  //     document.getElementById('result').innerText = res[0];
  // });
}

</script>

</head>

<body>

  <div class="container">
    <form>
      <h3>Get Ether with BTC</h2>
      <div class="form-group">
        <textarea class="form-control" name="textarea" rows="10" cols="50">Raw Tx</textarea>

        <label for="txHash">tx hash</label>
        <input type="text" class="form-control" id="txHash"></input>
        <label for="txBlockHash">block hash that tx belongs to</label>
        <input type="text" class="form-control" id="txBlockHash"></input>
        <label for="proofSiblings">Merkle Proof siblings</label>
        <input type="text" class="form-control" id="proofSiblings"></input>
        <label for="proofPaths">Merkle Proof paths</label>
        <input type="text" class="form-control" id="proofPaths"></input>

        <!-- TODO field for the address of the exchange contract -->
      </div>
    </form>

    <div id='call'>
      <input type="number" id="value"></input>
      <button type="button" onClick="callExampleContract();">transact()</button>
    </div>
    <div id="result"></div>

    <div class="jumbotron">
      <h5>Coinbase Address: <strong id="coinbase"></strong></h5>
      <h5>Balance: <strong id="balance"></strong></h5>
      <h5>Latest Block Number: <strong id="latestBlock"></strong></h5>
      <h5>Latest Block Timestamp: <strong id="latestBlockTimestamp"></strong></h5>
      <h5>Latest Block Hash: <strong id="latestBlockHash"></strong></h5>
      <h5>Contract String: <strong id="contractString"></strong></h5>
      <h5>Favourite Python: <strong id="favouritePython"></strong></h5>
      <br>
    </div>
  </div>

</body>

</html>
